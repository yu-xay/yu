### 订单


1. 生成订单 order order_detail
   1. 防止重复提交
   2. 验证参数 获取信息 检测优惠
   3. 获取其他订单信息(门店/表单等) 获取发货方式/地址 获取支付方式

   > 1. 发送MQ
   > 2. 下单验证 生成订单 订单判断优惠卷标记使用/积分扣除/购物车等 订单生成事件
   > 3. 失败日志

2. 生成支付订单
   1. payment_order_union => 支付交易表 1 (订单交易号|支持的支付方式)
   2. payment_order => 交易关联订单表 n （支付回调|订单号）

3. 获取支付交易信息
4. 完成支付
   1. 余额支付 记录信息修改订单状态 支付成功通知 触发支付完成事件
   2. 微信支付 页面请求支付 等待回调 记录信息修改订单状态 支付成功通知 触发支付完成事件


### 退款
1. 检查订单
2. 生成售后订单 售后订单详情 更新售后状态 
3. 调用退款订单 => payment_refund
4. 调用售后事件


### 发货
1. order_detail_express  物流表
2. order_detail_express_relation 物流关联商品详情表 (订单详情id|物流表id)


### 下单
+ 页面静态化
+ CDN加速
+ redis分布式锁 商品预热
+ 限流


